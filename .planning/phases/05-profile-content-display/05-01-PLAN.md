---
phase: 05-profile-content-display
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - classes/BlueSky_Render_Front.php
  - templates/frontend/profile-banner-full.php
  - templates/frontend/profile-banner-compact.php
  - assets/css/bluesky-profile-banner.css
autonomous: true

must_haves:
  truths:
    - "Profile banner full variant renders header image, overlapping avatar, name/handle/bio, and follower/following/post counts"
    - "Profile banner compact variant renders header image as background with overlaid avatar, name, and stats"
    - "When no header image exists, a placeholder gradient is rendered with data attribute for JS color extraction"
    - "Both variants link name/handle to Bluesky profile (existing behavior preserved)"
  artifacts:
    - path: "classes/BlueSky_Render_Front.php"
      provides: "render_profile_banner() method with layout param"
      contains: "render_profile_banner"
    - path: "templates/frontend/profile-banner-full.php"
      provides: "Full banner HTML template"
      contains: "bluesky-profile-banner-full"
    - path: "templates/frontend/profile-banner-compact.php"
      provides: "Compact card HTML template"
      contains: "bluesky-profile-banner-compact"
    - path: "assets/css/bluesky-profile-banner.css"
      provides: "Profile banner styles for both variants"
      contains: "bluesky-profile-banner"
  key_links:
    - from: "classes/BlueSky_Render_Front.php"
      to: "templates/frontend/profile-banner-full.php"
      via: "include in render_profile_banner()"
      pattern: "include.*profile-banner-full"
    - from: "classes/BlueSky_Render_Front.php"
      to: "BlueSky_API_Handler"
      via: "get_bluesky_profile() call"
      pattern: "get_bluesky_profile"
---

<objective>
Create the profile banner renderer with two layout variants (full banner and compact card) and their templates/CSS.

Purpose: Establishes the core render method that all three interfaces (block, widget, shortcode) will call, following the existing Render_Front template-inclusion pattern.
Output: render_profile_banner() method, two PHP templates, and CSS stylesheet.
</objective>

<execution_context>
@/Users/CRG/.claude/get-shit-done/workflows/execute-plan.md
@/Users/CRG/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-profile-content-display/05-RESEARCH.md
@classes/BlueSky_Render_Front.php
@templates/frontend/profile-card.php
@assets/css/bluesky-social-profile.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add render_profile_banner() method to BlueSky_Render_Front</name>
  <files>classes/BlueSky_Render_Front.php</files>
  <action>
Add a public `render_profile_banner($atts = [])` method to BlueSky_Render_Front. Follow the existing `render_bluesky_profile_card()` pattern:

1. Accept `$atts` array with keys: `layout` (string, 'full'|'compact', default 'full'), `account_id` (string, default ''), `theme` (string, default from options).
2. Merge with defaults using `wp_parse_args()`.
3. Fetch profile data via `$this->api_handler->get_bluesky_profile()`.
4. If profile is empty/false:
   - Check if stale cache was served (use existing stale-while-revalidate pattern from `render_bluesky_posts_list`).
   - If stale data available, prepend stale indicator banner (include `templates/frontend/stale-indicator.php` with `$time_ago`).
   - If no data at all, return empty string (graceful degradation).
5. Check if `$profile['banner']` is empty — if so, set a data attribute flag `$needs_gradient_fallback = true` and use a neutral placeholder CSS class instead of background-image.
6. Build CSS classes array: `['bluesky-profile-banner', "bluesky-profile-banner-{$layout}"]`, add theme class.
7. Set `$aria_label = __('Bluesky Profile Banner', 'social-integration-for-bluesky')`.
8. Select template: `'profile-banner-compact.php'` or `'profile-banner-full.php'` based on `$layout`.
9. Use `ob_start()` / `include` / `ob_get_clean()` pattern matching existing methods.
10. Template variables in scope: `$profile`, `$classes`, `$aria_label`, `$needs_gradient_fallback`, `$this`.

Also add a private helper `get_profile_banner_styles()` that returns inline `<style>` tag for banner-specific custom styles (follow `get_inline_custom_styles()` pattern but for banner context).
  </action>
  <verify>
Grep for `render_profile_banner` in `classes/BlueSky_Render_Front.php` — method must exist.
Grep for `profile-banner-full.php` and `profile-banner-compact.php` in the method — both template paths must be referenced.
  </verify>
  <done>
render_profile_banner() method exists in BlueSky_Render_Front, accepts layout/account_id/theme attributes, fetches profile data, handles missing banner with gradient fallback flag, and includes the correct template based on layout variant.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create profile banner templates and CSS</name>
  <files>
templates/frontend/profile-banner-full.php
templates/frontend/profile-banner-compact.php
assets/css/bluesky-profile-banner.css
  </files>
  <action>
**Full Banner Template** (`templates/frontend/profile-banner-full.php`):
- Bluesky-native style: wide header image (aspect-ratio 3/1) as CSS background on `.bluesky-profile-banner-header`.
- If `$needs_gradient_fallback` is true, add class `bluesky-banner-gradient-pending` and `data-avatar-url="(avatar URL)"` for JS color extraction. Use neutral `linear-gradient(135deg, #e0e0e0, #c0c0c0)` as default.
- Overlapping circular avatar (120x120 on desktop, 80x80 on mobile) positioned with negative margin to overlap header by ~40%.
- Below avatar: `<h2>` with display name linked to `https://bsky.app/profile/{handle}`, handle as `<p>`, bio as `<p>` with `nl2br(esc_html())`.
- Stats row: followers, following, posts — each as `<span class="bluesky-stat">` with `<strong>` count + label. Use `number_format_i18n()` for counts. All three stats visible on both variants per user decision.
- All text strings wrapped in `esc_html_e()` or `esc_html__()` with text domain `'social-integration-for-bluesky'`.
- `loading="lazy"` on avatar image.

**Compact Card Template** (`templates/frontend/profile-banner-compact.php`):
- Header image as full background with dark overlay (`linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.6))`).
- Same gradient fallback pattern as full variant if no header image.
- Smaller avatar (60x60) inline with content.
- Name, handle, and stats overlaid on background (white text for contrast).
- All same profile data: name (linked), handle, bio (shorter/truncated optional), all 3 stats.

**CSS** (`assets/css/bluesky-profile-banner.css`):
- Base `.bluesky-profile-banner` container styles.
- `.bluesky-profile-banner-full` variant: header image section with `aspect-ratio: 3/1; max-height: 200px; background-size: cover; background-position: center;` — avatar with `border-radius: 50%; border: 4px solid #fff; margin-top: -60px;` — content section with padding.
- `.bluesky-profile-banner-compact` variant: `background-size: cover; color: #fff; padding: 20px;` — flex layout with avatar + content side by side.
- Stats row: `display: flex; gap: 16px;` with `.bluesky-stat strong { display: block; }`.
- Responsive: `@media (max-width: 480px)` — stack compact variant vertically, reduce avatar sizes.
- Light/dark theme support matching existing theme classes.
- `.bluesky-banner-gradient-pending` — neutral placeholder gradient as default background.
- CSS custom property `--bluesky-banner-gradient` for JS to update after color extraction.
- Transition on background: `transition: background 0.3s ease;` for smooth gradient update.
- Link styles: name/handle links inherit color, no underline by default, underline on hover.
  </action>
  <verify>
Files exist: `templates/frontend/profile-banner-full.php`, `templates/frontend/profile-banner-compact.php`, `assets/css/bluesky-profile-banner.css`.
Full template contains `bluesky-profile-banner-header`, `bluesky-profile-banner-avatar`, `bluesky-stat`.
Compact template contains `bluesky-profile-banner-compact`, `data-avatar-url`.
CSS contains `@media`, `.bluesky-profile-banner-full`, `.bluesky-profile-banner-compact`.
  </verify>
  <done>
Both profile banner templates render complete Bluesky-style profile data (header, avatar, name, handle, bio, 3 stats) with proper escaping, i18n, accessibility attributes, and gradient fallback placeholder. CSS provides responsive layouts for both variants with theme support.
  </done>
</task>

</tasks>

<verification>
1. `render_profile_banner()` method exists in BlueSky_Render_Front with correct signature
2. Both templates render all required profile fields: header image, avatar, display name, handle, bio, followers, following, posts count
3. CSS file provides responsive styles for both full and compact variants
4. Gradient fallback mechanism uses data attributes for JS color extraction (not blocking render)
5. All user-facing strings use translation functions with correct text domain
</verification>

<success_criteria>
- render_profile_banner(['layout' => 'full']) produces HTML with header image, overlapping avatar, name/handle/bio, and 3 stat counts
- render_profile_banner(['layout' => 'compact']) produces HTML with background image, overlaid content, and 3 stat counts
- Missing banner triggers gradient fallback placeholder (not broken layout)
- CSS file loaded provides responsive styles for both variants
</success_criteria>

<output>
After completion, create `.planning/phases/05-profile-content-display/05-01-SUMMARY.md`
</output>
