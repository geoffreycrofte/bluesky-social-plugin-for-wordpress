---
phase: 02-codebase-refactoring
plan: 07
type: execute
wave: 5
depends_on: ["02-02", "02-03", "02-04", "02-05", "02-06"]
files_modified: []
autonomous: false
must_haves:
  truths:
    - "Plugin activates without errors in WordPress"
    - "Settings page loads and all tabs render correctly"
    - "AJAX-loaded content (profile cards, post feeds) displays on frontend"
    - "Post syndication to Bluesky works from editor"
    - "Discussion display renders on syndicated posts"
    - "All PHPUnit tests pass"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete Phase 2 refactoring works end-to-end in WordPress.

Purpose: After decomposing 3 monolithic classes, extracting templates, applying security fixes, and adding tests, we need human verification that the plugin functions identically to before refactoring.
Output: Confirmed working plugin or list of issues to fix.
</objective>

<execution_context>
@/Users/CRG/.claude/get-shit-done/workflows/execute-plan.md
@/Users/CRG/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-codebase-refactoring/02-02-SUMMARY.md
@.planning/phases/02-codebase-refactoring/02-03-SUMMARY.md
@.planning/phases/02-codebase-refactoring/02-04-SUMMARY.md
@.planning/phases/02-codebase-refactoring/02-05-SUMMARY.md
@.planning/phases/02-codebase-refactoring/02-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run automated verification checks</name>
  <files></files>
  <action>
Run the following checks and collect results:

1. **PHP syntax check on ALL class files:**
   ```bash
   for f in classes/BlueSky_*.php; do php -l "$f"; done
   ```

2. **PHP syntax check on ALL template files:**
   ```bash
   for f in templates/admin/*.php templates/frontend/*.php; do php -l "$f"; done
   ```

3. **PHPUnit test suite:**
   ```bash
   ./phpunit.phar --configuration phpunit.xml
   ```

4. **Hook registration count:** Compare number of add_action/add_filter/add_shortcode calls in Plugin_Setup's init_hooks against a known baseline (count from the original file should match).

5. **Security verification:**
   - Grep for `check_ajax_referer` in AJAX_Service -- confirm it appears in ALL 5 public AJAX handlers (fetch_posts, get_profile, async_posts, async_profile, async_auth)
   - Grep for `current_user_can.*manage_options` near godmode
   - Grep for `sanitize_text_field.*wp_unslash` in Syndication_Service
   - Grep for `current_user_can.*edit_post` in Syndication_Service

6. **i18n verification:**
   - Grep for bare English strings in wp_send_json_error calls -- should all be wrapped in __()
   - Grep for hardcoded user-visible strings in bluesky-async-loader.js -- should use blueskyAsync.i18n.*

7. **File structure verification:**
   - Confirm all expected files exist: 5 service classes, 3 discussion classes, 3 template files
   - Confirm Plugin_Setup is under 200 lines
   - Confirm Discussion_Display.php is empty/stubbed

Report all results. If any check fails, fix the issue before proceeding to human verification.
  </action>
  <verify>All automated checks pass. PHPUnit shows 0 failures. All security patterns confirmed by grep. All expected files exist.</verify>
  <done>Automated verification confirms code quality, security, and structural requirements met.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of end-to-end plugin functionality</name>
  <files></files>
  <action>
Present the verification checklist to the user. The following was built across Plans 02-01 through 02-06:
- Plugin_Setup decomposed from 3421 lines to ~100-150 lines (thin coordinator)
- 5 new service classes: Settings, AJAX, Syndication, Assets, Blocks
- Discussion_Display split into 3 focused classes: Metabox, Renderer, Frontend
- 3 template partials extracted (settings page, posts list, profile card)
- 3 security fixes: legacy AJAX nonce, godmode auth gate, POST sanitization
- i18n: 9 PHP strings + 13 JS strings wrapped in translation functions
- 20+ PHPUnit tests covering AJAX, Syndication, Settings, Helpers

Verification steps for the user:
1. Plugin activation: Deactivate then reactivate in WP admin. Confirm no errors.
2. Settings page: All tabs load, accounts display, settings save, godmode requires admin.
3. Frontend display: Profile cards and post feeds render via AJAX, no JS console errors.
4. Post syndication: Account selector works, dont-syndicate checkbox works, publish syndicates.
5. Discussion display: Threads render on syndicated posts, reply counts display.
6. Admin metabox: Discussion metabox appears, refresh and unlink buttons work.
  </action>
  <verify>User confirms all 6 verification areas pass, or describes issues found.</verify>
  <done>User types "approved" confirming plugin works identically to pre-refactoring state.</done>
</task>

</tasks>

<verification>
- All automated checks pass
- Human confirms plugin works identically to pre-refactoring
- No visual regressions, no broken functionality
- No JavaScript console errors
- Settings save correctly
- Syndication works
- Discussions display properly
</verification>

<success_criteria>
Plugin functions identically to before Phase 2. All decomposition is invisible to the end user. Security fixes are in place. Tests pass. Human approves.
</success_criteria>

<output>
After completion, create `.planning/phases/02-codebase-refactoring/02-07-SUMMARY.md`
</output>
